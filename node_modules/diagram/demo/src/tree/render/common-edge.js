const isHorizontalDirection = require('../util/is-horizontal')
const edgeColor = require('../constant/edge-color')

module.exports = (n, c, ctx, options, scale = 1) => {
  let beginNode = n
  let endNode = c
  const isHorizontal = isHorizontalDirection(options.direction)
  let beginP = beginNode.getAnchorPoint(beginNode.outAnchor)
  let endP = endNode.getAnchorPoint(endNode.inAnchor)
  if ((isHorizontal && n.x > c.x) || (!isHorizontal && n.y > c.y)) {
    beginNode = c
    endNode = n
    const tmp = beginP
    beginP = endP
    endP = tmp
  }

  ctx.strokeStyle = edgeColor
  ctx.beginPath()
  ctx.moveTo(beginP.x / scale, beginP.y / scale)
  if (isHorizontal) {
    ctx.bezierCurveTo(
      (beginP.x + (beginNode.hgap + endNode.hgap) / 2) / scale,
      beginP.y / scale,
      (endP.x - (beginNode.hgap + endNode.hgap) / 2) / scale,
      endP.y / scale,
      endP.x / scale, endP.y / scale
    )
  } else {
    ctx.bezierCurveTo(
      beginP.x / scale,
      (beginP.y + (beginNode.vgap + endNode.vgap) / 2) / scale,
      endP.x / scale,
      (endP.y - (beginNode.vgap + endNode.vgap) / 2) / scale,
      endP.x / scale, endP.y / scale
    )
  }
  ctx.stroke()
}
